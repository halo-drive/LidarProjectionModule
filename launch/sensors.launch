<?xml version="1.0"?>
<launch>
  <!-- Get the package path -->
  <arg name="pkg_path" default="$(find lane_fusion)"/>

  <!-- Camera 0 Node -->
  <group ns="camera0">
    <node name="usb_cam_node" pkg="usb_cam" type="usb_cam_node" output="screen">
      <!-- Camera device settings -->
      <param name="video_device" value="/dev/video0"/>
      <param name="camera_frame_id" value="camera0_link"/>
      <param name="camera_name" value="camera0"/>

      <!-- Image settings -->
      <param name="image_width" value="640"/>
      <param name="image_height" value="480"/>
      <param name="framerate" value="30"/>
      <param name="pixel_format" value="yuyv"/>
      <param name="io_method" value="mmap"/>

      <!-- Camera controls -->
      <param name="auto_exposure" value="true"/>
      <param name="auto_white_balance" value="true"/>
      <param name="auto_focus" value="false"/>

      <!-- Calibration file path - point to your project config -->
      <param name="camera_info_url" value="file://$(arg pkg_path)/config/camera_params/camera0.yaml"/>

      <!-- Topic remapping to remove extra namespace -->
      <remap from="image_raw" to="/camera0/image_raw"/>
      <remap from="camera_info" to="/camera0/camera_info"/>
    </node>
  </group>

  <!-- LiDAR 0 Driver and Point Cloud -->
  <group ns="lidar0">
    <!-- Nodelet manager -->
    <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager" output="screen"/>

    <!-- Driver nodelet -->
    <node pkg="nodelet" type="nodelet" name="driver_nodelet"
          args="load velodyne_driver/DriverNodelet nodelet_manager" output="screen">
      <param name="device_ip" value="192.168.2.201"/>
      <param name="port" value="2368"/>
      <param name="frame_id" value="lidar0_link"/>
      <param name="model" value="VLP16"/>
      <param name="rpm" value="600"/>
    </node>

    <!-- Point cloud nodelet - Use default calibration -->
    <node pkg="nodelet" type="nodelet" name="pointcloud_nodelet"
          args="load velodyne_pointcloud/TransformNodelet nodelet_manager" output="screen">
      <param name="model" value="VLP16"/>
      <!-- Remove custom calibration - use default VLP16 calibration -->
      <param name="frame_id" value="lidar0_link"/>
      <param name="min_range" value="0.4"/>
      <param name="max_range" value="100.0"/>
      <param name="organize_cloud" value="false"/>

      <!-- Topic remapping -->
      <remap from="velodyne_points" to="/lidar0/velodyne_points"/>
    </node>
  </group>

  <!-- LiDAR 1 Driver and Point Cloud -->
  <group ns="lidar1">
    <!-- Nodelet manager -->
    <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager" output="screen"/>

    <!-- Driver nodelet -->
    <node pkg="nodelet" type="nodelet" name="driver_nodelet"
          args="load velodyne_driver/DriverNodelet nodelet_manager" output="screen">
      <param name="device_ip" value="192.168.2.202"/>
      <param name="port" value="2368"/>
      <param name="frame_id" value="lidar1_link"/>
      <param name="model" value="VLP16"/>
      <param name="rpm" value="600"/>
    </node>

    <!-- Point cloud nodelet - Use default calibration -->
    <node pkg="nodelet" type="nodelet" name="pointcloud_nodelet"
          args="load velodyne_pointcloud/TransformNodelet nodelet_manager" output="screen">
      <param name="model" value="VLP16"/>
      <!-- Remove custom calibration - use default VLP16 calibration -->
      <param name="frame_id" value="lidar1_link"/>
      <param name="min_range" value="0.4"/>
      <param name="max_range" value="100.0"/>
      <param name="organize_cloud" value="false"/>

      <!-- Topic remapping -->
      <remap from="velodyne_points" to="/lidar1/velodyne_points"/>
    </node>
  </group>

  <!-- Static Transform Publishers -->
  <node pkg="tf2_ros" type="static_transform_publisher" name="base_to_camera0"
        args="0.0 0.0 0.0 0.0 0.0 0.0 base_link camera0_link"/>

  <node pkg="tf2_ros" type="static_transform_publisher" name="base_to_lidar0"
        args="0.0 0.0 0.0 0.0 0.0 0.0 base_link lidar0_link"/>

  <node pkg="tf2_ros" type="static_transform_publisher" name="base_to_lidar1"
        args="0.0 0.0 0.0 0.0 0.0 0.0 base_link lidar1_link"/>

</launch>